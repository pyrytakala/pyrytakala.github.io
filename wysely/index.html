<html>
<head>
	<link rel="stylesheet" href="styles.css">
	
</head>
<body>

<!-- Shared component -->
<div class='section header'>
	<div class='container'>
		<div class='container' id='header'>
			<div>
				<div class='header-logo'>
					<a href='index.html'>SuperGoodInvestor.com</a>
				</div>
				<div class='header-menu'>
					<a href=''>About us</a> &nbsp; <a href=''>Contact</a>
				</div>
			</div>
		</div>
	</div>
</div>


<div class='section'>
	<div class='container' style='position: relative;' id='presearch'>
		<img src='i/hero-pic.png'>
		<div class='hero-text'>
			<h1>Invest in good companies</h1>
			<h4>Find out how responsible the company is - before you invest. </h4>
		</div>
	</div>
</div>

<div class='section big' style="background-color: #F5F5F5;">
	<div class='container'>
		<h1 id='initialCTA'>Start by searching for a company</h1>
	</div>
	<div class='container'>
		<div class="container-flex">
			<div class="col-left">
				<div id='filters'>
				</div>
			</div>  

			<div class="col-right">
				<div id='search' style='text-align: center;'>
					üîç <input autofocus id='searchBox' placeholder='Type company name or ticker' oninput='renderResultTable()'>
				</div>
				<div id='table'>
				</div>
			</div> 
		</div>
	</div>
</div>

<!-- Shared component -->
<div class='section footer'>
	<div class='container'>
		<div>
			@SuperGoodInvestor
		</div>
	</div>
</div>



<script src="db.json"></script>
<script src="meta.json"></script>
<script src="utils.js"></script>
<script src="https://kit.fontawesome.com/d3970290e6.js" crossorigin="anonymous"></script>
<script>



function renderFilters() {
	
	add = ''
	
	var cols = []
	Object.keys(db[0]).forEach(function(column) {
		cols.push(column)
	});
	
	var filterIds = new Set()
	cols.forEach(function(col) {
		if (col.length > 1 && meta_filters.has(col)) {
			add += '<div class="filter"><p class="filter-title"><i class="fas fa-filter"></i> ' + col + '</p>'
			db.forEach(function(item) {
				id = col + item[col]
				if (!filterIds.has(id)) {
					add += '<p><input type="checkbox" id="' + id + '" checked onclick="renderResultTable()"> ' + item[col]
					filterIds.add(id)
				}
			});
			add += "</div>"
		}
	});

	document.getElementById('filters').innerHTML += add
}

function renderResultTable() {

	var results = db.filter(e => passesFilters(e));

	if (results[0] == null) {
		add = 'No results. Consider resetting your filters.'
		
	}
	else {

		add = ''	
		// rows
		results.forEach(function(e) {
			add += '<div class="result"><a href="item.html?id=' + e['Symbol'] + '">'

			for (const [key, value] of Object.entries(e)) {

				if (key in meta_index_attributes) {
					add += "<div class='kv-pair container'>" + display(key, value, meta_index_attributes) + "</div>";
				}
				
			}
			add += '</a></div>'
		})
	}

	document.getElementById('table').innerHTML = add
}



function passesFilters(value) {
	var ok = true
	
	// binary filters
	Object.keys(value).forEach(e => {

		attrib_name = e + value[e]
		attrib_id = document.getElementById(attrib_name)

		if (attrib_id != null && !attrib_id.checked) {
			ok = false
		}
	});

	// name filters (search)
	query = document.getElementById('searchBox').value.toLowerCase()
	searchable = (value["Name"] + value["Symbol"]).toLowerCase()

	if (!searchable.includes(query)) {
		ok = false
	}

	return ok;		
}


renderFilters()
renderResultTable()




	  
</script>


<i class="fas fa-filter" style="display: none;"></i> <!-- for faster icon loading -->


</body>
</html>



